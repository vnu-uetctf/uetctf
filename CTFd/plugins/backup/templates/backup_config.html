{% extends "admin/base.html" %}

{% block content %}
<div class="jumbotron">
    <div class="container">
        <h1>{{ "Backup"}}</h1>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <ul class="nav nav-pills flex-column">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="pill"
                       href="#settings">{{ "Settings" }}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="pill" href="#record">{{ "Record" }}</a>
                </li>
            </ul>
        </div>
        <div class="col-md-9">
            <div class="tab-content">
                <div class="config-section tab-pane fade show active" id="settings" role="tabpanel"
                     aria-autocomplete="none">
                    <form method="POST" accept-charset="utf-8" action="/admin/plugins/backup"
                          class="form-horizontal">
                        {% set enabled = get_config('backup:enabled') %}
                        <div class="form-group">
                            <label for="enabled">
                                {{ "Enable Switch" }}
                                <small class="form-text text-muted">
                                    {{ "Whether to enable auto backup" }}
                                </small>
                            </label>
                            <select id="enabled" name="backup:enabled" class="form-control custom-select">
                                <option value="true" {{
                                "selected" if enabled == true }}>{{ "ON" }}</option>
                                <option value="false" {{
                                "selected" if enabled == false }}>{{ "OFF" }}</option>
                            </select>
                        </div>
                        {% set interval = get_config('backup:interval') %}
                        <div class="form-group">
                            <label for="interval">
                                {{ "Backup interval (Unit: day)" }}
                            </label>
                            <div class="input-group">
                                <input class="form-control" id='interval' name='backup:interval' type='number'
                                       {% if interval is defined and interval !=None %}value="{{ interval }}" {% endif
                                       %}>
                                <div class="input-group-append">
                                    <span class="input-group-text">{{ "Days" }}</span>
                                </div>
                            </div>
                        </div>

                        {% set time = get_config('backup:time') %}
                        <div class="form-group">
                            <label for="time">
                                {{ "Backup time (Unit: hour)" }}
                            </label>
                            <div class="input-group">
                                <input class="form-control" id='time' name='backup:time' type='number' max="24" min="0"
                                       {% if time is defined and time !=None %}value="{{ time }}" {% endif %}>
                                <div class="input-group-append">
                                    <span class="input-group-text">{{ "Hours" }}</span>
                                </div>
                            </div>
                        </div>

                        {% set max = get_config('backup:max') %}
                        <div class="form-group">
                            <label for="max">
                                {{ "Backup Max Number" }}
                            </label>
                            <div class="input-group">
                                <input class="form-control" id='max' name='backup:max' type='number'
                                       {% if max is defined and max !=None %}value="{{ max }}" {% endif %}>
                            </div>
                        </div>

                        <div class="submit-row float-right">
                            <button type="submit" tabindex="0" class="btn btn-md btn-primary btn-outlined">
                                {{ "Submit" }}
                            </button>
                        </div>
                    </form>
                </div>
                <div class="tab-pane fade" id="record" role="tabpanel">
                    <table class="table">
                        <thead>
                        <tr>
                            <th class="text-center">{{ "File Name" }}</th>
                            <th class="text-center">{{ "Size" }}</th>
                            <th class="text-center">{{ "Date"}}</th>
                            <th class="text-center" colspan="2">{{ "Actions" }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for file in backup_files %}
                        <tr>
                            <td>{{ file['name'] }}</td>
                            <td class="text-center">{{ file['size'] }}</td>
                            <td class="text-center">
                                <span data-time="{{ file['date'] | isoformat }}"></span>
                            </td>
                            <td class="text-center">
                                <a href="/plugins/backup/admin/download?name={{file['name']}}" target="_blank" data-toggle="tooltip"
                                   data-placement="top">
                                    {{ "Download" }}
                                    <i class="fas fa-file-download"></i>
                                </a>
                            </td>
                            <td class="text-center">
                                <a class="delete-backup" data-filename="{{file['name']}}" href="javascript:void(0)" data-toggle="tooltip"
                                   data-placement="top">
                                    {{ "Delete" }}
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <div class="submit-row float-right">
                        <button type="button" tabindex="0" class="btn btn-md btn-primary btn-outlined backup-now">
                            {{ "Backup Now" }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script defer src="/plugins/backup/static/config.js"></script>
<script defer src="/plugins/backup/static/delete.js"></script>
{% endblock %}